# Chapter2-2 스프링 테스트

# 🎈 일반적으로 테스트하기 좋은 코드가 좋은 코드일 가능성이 높다!!

## 스프링 테스트 적용

**애플리케이션 컨텍스트가 만들어질 때**는 모든 `싱글톤 빈 오브젝트를 초기화`한다. 

- `어떤 빈`은 **오브젝트가 생성될 때** <ins>**자체적인 초기화 작업을 하기 때문에 많은 시간을 소요**</ins>하는 경우가 있다. 
- `애플리케이션 컨텍스트`가 **초기화 될 때** `어떤 빈`은 <ins>**독자적으로 많은 리소스를 할당**</ins>하거나 <ins>**독립적인 스레드**</ins>를 띄우기도 한다. 

➡︎ **테스트를 마칠 때** 마다 <span style="color:orange;">**애플리케이션 컨텍스트 내의 빈이 할당된 리소스 등을 깔끔하게 정리해 주지 않으면**</span> <span style="color:#F05750;">**다음 테스트에서 새로운 애플리케이션 컨텍스트가 만들어지는 문제**</span>를 일으킬 수도 있다. 


> 💡  **테스트는 가능한 독립적으로 매번 새로운 오브젝트를 만들어서 사용하는 것이 원칙이다.** 
> 
> 🔔  다만, 생성에 **많은 시간과 자원이 소모되는 경우**에는 `테스트 전체가 공유하는 오브젝트`를 만들기도 한다. 


<br>

### 💭 테스트 전체가 공유하는 오브젝트?

애플리케이션 컨텍스트에서 빈은 **싱글톤**으로 만들기 때문에 **상태를 갖지 않는다.** 

따라서 초기화 되고 나면 <ins>**내부의 상태가 바뀌는 일은 거의 없다.**</ins> 

➡︎ <span style="color:orange;">애플리케이션 컨텍스트</span>는 한번만 만들고 **여러 테스트가 공유해서 사용해도 된다.** 


> ⚠️ JUnit은 매번 테스트 클래스의 오브젝트를 새로 만든다. 따라서, 애플리케이션 오브젝트를 오브젝트 레벨로 저장하면 곤란하다. 


<br>

### 👍🏻 스태틱 필드에  필드에 저장


<br>

## 테스트를 위한 애플리케이션 컨텍스트 관리 

- 스프링은 `테스트 메소드`, `클래스` 사이에서 **애플리케이션 컨텍스트를 공유**하게 해준다. 

<span style="color:#FFD700;">**@Autowired** </span>

- `테스트 컨텍스트 프레임워크`는 **변수 타입과 일치하는 컨텍스트 내의 빈을 찾고 일치하는 빈이 있다면 인스턴스 변수에 주입**해준다. 

- DI설정 없이 필드의 타입 정보를 이용해 빈을 가져올 수 있다. **[자동와이어링]**

- 애플리케이션 컨텍스트는 초기화 할 때 자기 자신도 빈으로 등록한다. 따라서 빈을 직접 DI 받을 수도 있다 


> ⚠️ 빈이 <span style="color:#F05750;">**2개 이상 있는 경우 어떤 빈을 가져올지 결정할 수 없다.**</span> 


<br>

<span style="color:#FFD700;">**@RunWith** </span> 

JUnit 프레임워크의 테스트 실행 방법을 확장할 때 사용하는 어노테이션 

<br>

<span style="color:#FFD700;">**@ContextConfiguration** </span>

자동으로 만들어줄 애플리케이션 컨텍스트의 설정파일 위치 지정


> 💡 테스트는 필요하다면 얼마든지 애플리케이션 클래스와 밀접한 관계를 맺고 있어도 상관없다. 
> 
>       하지만,  꼭 필요하지 않다면 최대한 느슨하게 연결하는 것이 좋다. 



<br>

## DI와 테스트

**인터페이스를 두고 DI를 적용하는 이유**

- 소프트웨어 개발에서 절대로 바뀌지 않는 것은 없다. 
- 클래스 구현 방식은 바뀌지 않더라고 인터페이스를 두고 DI를 적용하게 한다면 다른 차원의 서비스 기능을 도입할 수 있다. 
- 효율적인 테스트를 손쉽게 만들기 위해서 

>  <span style="color:#FFD700;">**@DirtiesContext** </span>
> 
> - 해당 어노테이션이 붙은 테스트 클래스에는 <span style="color:orange;">**애플리케이션 공유를 허용하지 않는다.**</span> 
> 
> - `테스트 메서드를 수행`하고 나면 매번 <ins>**새로운 애플리케이션 컨텍스트를 만들어서 다음 테스트가 사용할 수 있도록 해준다**</ins>
> 
> ➡︎ 변경한 컨텍스트가 **뒤의 테스트에 영향을 주지 않게 하기 위해서** 

<br>

### 컨테이너 없는 DI 테스트 

테스트 코드에서는 직접 오브젝트를 만들고 DI 해서 사용해도 된다.

```java
public class Test {
    Dao dao;

    @Before
    public void setUp() {
        this.dao = new Dao(); //객체 생성 
    }
}
```

매번 **새로운 Dao 오브젝트가 만들어진다는 단점이 있지만 코드가 더 단순하고 이해하기 편해진다.** 

<br>

### DI 컨테이너나 프레임워크는 DI를 편하게 적용하도록 도움을 줄 뿐 <ins>반드시 필요한 것은 아니다.</ins> 

<br>

### 💡 **침투적 기술 VS 비침투적 기술**
> 
> **침투적 기술:** 기술을 적용했을 때 코드에 API가 등장하거나, 특정 인터페이스나 클래스를 사용하도록 강제하는 것
> 

 ➡ ︎코드가 **기술에 종속되는 결과**를 가져온다.

> **비침투적 기술:** 기술 적용 시 코드에 아무런 영향을 주지 않고 적용이 가능한 것

  ➡ ︎코드가 **기술에 종속되지 않아 순수한 코드를 유지**할 수 있다. 

> 스프링은 비침투적인 기술의 대표적인 예이다. 따라서, 스프링 컨테이너 없이 DI 테스트가 가능하다. 

<br>

### DI를 이용한 테스트 방법 선택

<span style="color:orange;">**스프링 컨테이너 없이 테스트할 수 있는 방법을 가장 우선적으로 고려**</span>해야 한다.

- **여러 오브젝트와 복잡한 의존 관계를 갖고 있는 오브젝트를 테스트**

  ➡︎ 스프링의 설정을 이용한 DI 방식의 테스트 이용



- **테스트에서 애플리케이션 컨텍스트를 사용하는 경우**

  ➡︎ 테스트 전용 설정 파일 만들어서 사용


<br>

## 학습 테스트로 배우는 스프링

자신이 만들지 않은 프레임워크나 라이브러리 등에 대해 테스트를 하는 것 ➡ **학습 테스트 (Learning test)**

<br>

**[목적]**

`기술`이나 `기능`에 대해 <ins>**얼마나 이해**</ins>하고 있고 <ins>**그 사용 방법을 바로 알고 있는지 검증**</ins>하기 위한 것이 목적이다. 

<br>

**[장점]**

- 다양한 조건에 따른 기능을 손쉽게 확인해 볼 수 있다. 


- 학습 테스트 코드를 개발 중에 참고할 수 있다. (상황을 더 찾아봐야 할 것 같다.)

    ➡︎ 테스트로 새로운 기술의 다양한 기능을 사용하는 코드를 만들어두면 실제 개발에서 샘플 코드로 참고할 수 있다. 


- 제품을 업그레이드할 때 <span style="color:orange;">**호환성 검증**</span>을 도와준다.

<br>

 ### 🚀 새로운 버전으로 업데이트 할 때 🚨버그가 추가되는 경우🚨가 가끔 있어서 업그에이드 후의 시스템이 미묘한 문제를 일으킬 수 있다. 

### ➡︎ 이런 경우 문제가 없던 <span style="color:#F05750;">**이전 버전으로 다운그레이드**</span>를 해야한다. 


> 💡 `학습 테이터`를 이용한다면 직접 적용하지 않고도 기존에 문제가 발생하는지 안하는지 **미리 확인해 볼 수 있다.** 
> 
> <ins>**새로운 버전의 프레임워크나 제품을 학습 테스트에만 먼저 적용**</ins>해본다. 

<br>

- 테스트 코드에 익숙해질 수 있는 좋은 훈련이 된다. 


- **새로운 기술을 공부하는 과정이 즐거워진다.** 👍🏻 **(개인적으로 공감하는 문장)** 👍🏻

  ➡ 힘들어도 책보다는 나을 것 같다 ^^


<br>

**[예제]**
1. 새로운 테스트 클래스를 만들고   3개의 테스트 메소드를 추가한다. 
2. 테스트 클래스: 자신으 타입으로 스태틱 변수를 선언 
3. 테스트 메소드: 현재 스태틱 변수에 담긴 오브젝트와 자신을 비교해서 같지 않다는 것을 확인
4. 현재 오브젝트를 스태틱 변수에 저장


<br>

### 버그 테스트
오류를 잘 드러내줄 수 있는 테스트를 의미한다. 


**[사용해야 하는 이유]**
- 불충분 했던 테스트의 완성도를 높여준다. 
- 버그 내용을 명확하게 분석해준다. 
- 기술적인 문제를 해결하는데 도움이 된다. 

> 💡 **동등분활** 
> 
>  ➡︎ 같은 결과를 내는 값의 범위를 구분해서 각 대표 값으로 테스트를 하는 방법 
>
> **ex**
> 
> 어떤 작업의 결과가 true, false, 예외 발생 이라고 한다면, 각 <ins>**결과를 내는 상황을 만들어 모든 상황에 대해 테스트 하는 것**</ins>을 말한다. 

